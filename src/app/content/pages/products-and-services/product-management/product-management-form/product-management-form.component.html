<div class="form-content">
  <form [formGroup]="productForm" class="form p-3" id="productForm">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between mb-3 mt-1">
          <h5 class="box-title mb-0">
            <div *ngIf="editMode" class="hide">
              <h3>{{product | localTranslate: 'commercialDescription'}}</h3>
            </div>
            <div *ngIf="!editMode">{{'PRODUCT_FORM.ADD_PRODUCT' | translate}}</div>
          </h5>
        </div>

        <div class="row">
          <div class="col-lg-2 col-md-2 col-12 d-flex justify-content-center align-items-center mb-2">
            <div class="row sortable-grid sortable-item">
              <div class="thumbnail mt-3">
                <img [src]="product?.mainImage || '/assets/img/products/product-default.jpg'" alt="main image">
                <ul class="menu-overlay" *ngIf="product?.mainImage">
                  <li>
                    <button matTooltip="{{'BUTTONS.DELETE' | translate}}"
                            (click)="$event.stopPropagation(); unsetMainImage();"
                            matTooltipPosition="above"
                            mat-icon-button color="primary">
                      <em class="fas fa-trash"></em>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-lg-10">
            <div class="form-row mt-2">

              <div class="form-group col-lg-3 col-md-3 mt-4">
                <label>{{'PRODUCT_FORM.CREATED_AT' | translate}} </label>
                <input class="form-control form-control-sm"
                       formControlName="createdAt"
                       placeholder="{{'PRODUCT_FORM.CREATED_AT' | translate}}" type="text">
              </div>
              <div class="form-group col-lg-3 col-md-3 mt-4">
                <label>{{'PRODUCT_FORM.UPDATED_AT' | translate}} </label>
                <input class="form-control form-control-sm"
                       formControlName="updatedAt"
                       placeholder="{{'PRODUCT_FORM.UPDATED_AT' | translate}}" type="text">
              </div>
              <div class="form-group col-lg-3 col-md-3 mt-4">
                <label>{{'PRODUCT_FORM.CONSULTATION_NUMBER' | translate}} </label>
                <input class="form-control form-control-sm" disabled formControlName="consultationNumber"
                       placeholder="{{'PRODUCT_FORM.CONSULTATION_NUMBER' | translate}}"
                       type="number">
              </div>
              <div class="form-group col-lg-3 col-md-3 mt-4">
                <label>{{'PRODUCT_FORM.LAST_VISITED' | translate}} </label>
                <input class="form-control form-control-sm" disabled="disabled" formControlName="lastVisitedDate"
                       placeholder="{{'PRODUCT_FORM.LAST_VISITED' | translate}}" type="text">
              </div>
              <!-- igesa code: is the imported code from igesa (foodmanager / sellpoint) -->
              <div class="form-group col-lg-3 col-md-3 ">
                <label>{{'PRODUCT_FORM.IGESA_CODE' | translate}} </label>
                <input class="form-control form-control-sm" disabled formControlName="code" readonly
                       placeholder="{{'PRODUCT_FORM.IGESA_CODE' | translate}}" type="text">
              </div>

              <div class="form-group col-lg-3 col-md-3 d-flex align-items-start justify-content-between pt-4">
                <label class="form-check-label" style="margin-top: 10px !important;">
                  <mat-checkbox [formControl]="activeDetailSaleFormControl"></mat-checkbox>
                  {{'Attivo' | translate}}
                </label>
                <label class="ml-2" style="margin-top: 10px !important;">
                  <mat-checkbox [disabled]="editMode && !editClicked" [checked]="product?.inEvidenza"
                                (change)="changeInEvidenza(product)"></mat-checkbox>
                  {{'In Evidenza' | translate}}
                </label>
              </div>

              <!--    codes                -->
              <div class="form-group col-lg-6 col-md-6">
                <label>{{'PRODUCT_FORM.CODE' | translate}} </label>
                <div
                  style="border-radius: 0.2rem !important; margin-left: 1px; margin-right: 1px;"
                  [ngStyle]=" {'border' : editClicked ? '1px solid #c6c6c6' : '1px solid #c6c6c6'}">
                  <div class="d-flex justify-content-between" style="margin-right: 13px !important;">
                    <div></div>
                    <a (click)="addProductCode(productCode)" *ngIf="!editMode || editClicked "
                       class="text-muted"><em class="fa fa-plus"></em></a>
                  </div>
                  <div style="max-height: 100px; overflow-y: scroll;">
                    <div *ngFor="let pct of altProdCodes" class="flexbox mb-3" style="padding: 8px !important;">
                      <div>
                        <span> {{pct.code }}</span>
                      </div>
                      <span class="mb-0 text-muted small-text">{{pct.codeType}}</span>
                      <span *ngIf="!editMode || editClicked ">
                        <span (click)="editProductCode(productCode, pct)"
                              class="text-primary"
                              ngbTooltip="{{'BUTTONS.EDIT'|translate}}" placement="right"
                              tooltipClass="custom-tooltip">
                            <em class="ti-pencil ml-3"></em>
                          </span>
                        <span (click)="deleteProductCode(pct)"
                              class="text-danger"
                              ngbTooltip="{{'BUTTONS.DELETE'|translate}}" placement="right"
                              tooltipClass="custom-tooltip">
                            <em class="ft-trash-2 ml-3"></em>
                          </span>
                        </span>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="card">
      <div class="card-body">
        <div class="row">
          <ngb-tabset #t="ngbTabset" style="width: 100%;" [activeId]="activeTabId">

            <!-- general information management tab  -->
            <ngb-tab id="tab-general-inf" title="{{'PRODUCT_FORM.GENERAL_INF' | translate}}">
              <ng-template ngbTabContent>
                <div class="container">
                  <div class="form-row">

                    <div class="form-group col-lg-6 col-md-6">
                      <label>{{'PRODUCT_FORM.DESCRIPTION_PLU' | translate}} </label>
                      <div style="display: flex">
                        <input [formControl]="descriptionByLang"
                               [ngClass]="{ 'is-invalid': submitted && productForm.get('description').invalid }"
                               class="form-control form-control-sm"
                               placeholder="{{'PRODUCT_FORM.DESCRIPTION_PLU' | translate}}"
                               type="text">

                        <em (click)="addDescription()" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>
                      <div
                        *ngIf="productForm.get('description').valid && (descriptionByLang.value === null || descriptionByLang.value.length === 0)"
                        class="invalid-feedback orange">
                        {{'PRODUCT_FORM.DESCRIPTION_NON_DISPO' | translate}}
                      </div>
                    </div>

                    <div class="form-group col-lg-6 col-md-6">
                      <label>{{'PRODUCT_FORM.COMMERCIAL_DESCRIPTION' | translate}} </label>
                      <div style="display: flex">
                        <input [formControl]="commercialDescriptionByLang"
                               [ngClass]="{ 'is-invalid': submitted && productForm.get('commercialDescription').invalid }"
                               class="form-control form-control-sm"
                               placeholder="{{'PRODUCT_FORM.COMMERCIAL_DESCRIPTION' | translate}}"
                               type="text">
                        <em (click)="addCommercialDescription()" class="fa fa-plus"
                            ngbTooltip="{{'BUTTONS.ADD'|translate}}" placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>

                      <div *ngIf="productForm.get('commercialDescription').valid
                      && (commercialDescriptionByLang.value === null || commercialDescriptionByLang.value.length === 0)"
                           class="invalid-feedback orange">
                        {{'PRODUCT_FORM.DESCRIPTION_NON_DISPO' | translate}}
                      </div>
                    </div>


                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.BRAND' | translate}} </label>
                      <div style="display: flex">
                        <ng-select (scrollToEnd)="getBrand()" [items]="brandList" [virtualScroll]="true"
                                   bindLabel="description"
                                   bindValue="id" class="ng-select-sm ng-select-required"
                                   formControlName="brandId" placeholder="{{'BUTTONS.CHOOSE' | translate}}"
                                   style="width: 90%">
                        </ng-select>
                        <em (click)="addBrand()" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>
                    </div>

                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.MANUFACTURER' | translate}} </label>
                      <div style="display: flex">

                        <ng-select (scrollToEnd)="getConfigurationsByType('MANUFACTURER')" [bindLabel]="'description'"
                                   [bindValue]="'id'"
                                   [items]="manufacturersList"
                                   [virtualScroll]="true" class="ng-select-sm"
                                   formControlName="manufacturerId"
                                   placeholder="{{'BUTTONS.CHOOSE' | translate}}"
                                   style="width: 100%">
                        </ng-select>
                        <em (click)="addManufacturer()" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>
                    </div>

                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.TAX' | translate}} :</label>
                      <div style="display: flex">
                        <ng-select (scrollToEnd)="getConfigurationsByType('TAX')"
                                   bindLabel='description'
                                   [bindValue]="'id'"
                                   [items]="IvaCodeList"
                                   [virtualScroll]="true" class="ng-select-sm w-100"
                                   formControlName="taxId"
                                   placeholder="{{'BUTTONS.CHOOSE' | translate}}">

                          <ng-template ng-label-tmp let-item="item">

                            <span>{{item.description.trim().length > 0 ? (item.description + ' : ' + item.value) : item.value }}</span>

                          </ng-template>

                          <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">

                            <span>{{item.description.trim().length > 0 ? (item.description + ' : ' + item.value) : item.value }}</span>

                          </ng-template>
                        </ng-select>
                        <em (click)="addTAX()" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>
                    </div>

                    <div class="form-group col-lg-3 col-md-3"
                         style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PRICE' | translate}} </label>
                      <input [formControl]="priceFormControl" class="form-control form-control-sm" currencyMask
                             type="tel" [readOnly]="productForm.get('weighted').value">
                    </div>


                    <!--          <div class="form-group col-lg-3 col-md-3">
                                <label>{{'PRODUCT_UM_FORM.ALTERNATIVE_UNITS' | translate}} </label>
                                <div style="display: flex">
                                  <a class="nav-item dropdown" display="dynamic" ngbDropdown style="width: 100%;">
                                    <a [ngClass]="{'disabledbutton' : editMode && !editClicked}"
                                       class="dropdown-toggle no-arrow d-inline-flex align-items-center"
                                       ngbDropdownToggle style="width: 100%;">
                                      <input class="form-control form-control-sm"
                                             placeholder="{{'PRODUCT_UM_FORM.ALTERNATIVE_UNITS' | translate}}"
                                             type="text">
                                    </a>
                                    <div class="dropdown-menu pt-0" ngbDropdownMenu style="min-width: 280px;">
                                      <a *ngIf="rows.length == 0" class="dropdown-item d-flex align-items-center mt-2 mb-2">
                                        {{'PRODUCT_UM_FORM.NO_ALT_UNITS' | translate}}
                                      </a>

                                      <a *ngFor="let pum of rows" class="dropdown-item d-flex align-items-center mt-2 mb-2">
                                        {{pum.um?.code}}
                                        <a (click)="edit(content, pum)" class="text-primary"
                                           ngbTooltip="{{'BUTTONS.EDIT'|translate}}"
                                           placement="right"
                                           tooltipClass="custom-tooltip">
                                          <em class="ti-pencil ml-3"></i>
                                        </a>
                                        <a (click)="delete(pum)" class="text-danger" ngbTooltip="{{'BUTTONS.DELETE'|translate}}"
                                           placement="right"
                                           tooltipClass="custom-tooltip">
                                          <em class="ft-trash-2 ml-3"></i>
                                        </a>
                                      </a>
                                    </div>
                                  </a>

                                  <em (click)="openFormDialog(content)" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                                     placement="left"
                                     placement="left" style="margin: 7px;" tooltipClass="custom-tooltip"></i>

                                </div>
                              </div>
          -->

                    <div class="form-group col-lg-2 col-md-2 d-flex align-items-center justify-content-start"
                         style="padding-right: 10px !important">
                      <label style="margin-top: 25px; margin-left: 1px;">
                        {{'PRODUCT_FORM.WEIGHTED' | translate}}
                        <mat-checkbox class="ml-2 mt-1" formControlName="weighted"></mat-checkbox>
                      </label>
                    </div>


                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PRICE_PER_UM' | translate}} </label>
                      <input class="form-control form-control-sm" currencyMask
                             formControlName="pricePerPrincipalMeasureUnit" type="tel"
                             [ngClass]="{ 'is-invalid': submitted &&  productForm.get('pricePerPrincipalMeasureUnit').invalid }"
                      >
                    </div>

                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 5px !important">

                      <label>{{'PRODUCT_FORM.MEASURE_UNIT' | translate}}</label>
                      <div class="d-flex">

                        <ng-select (clear)="clear()" (close)="reset()" (open)="open()"
                                   (scrollToEnd)="getLazyUm({ page: this.umPage, pageSize: 10})"
                                   (search)="searchUm($event)" [items]="um" [loading]="loading"
                                   [virtualScroll]="true"
                                   bindLabel="code" bindValue="id" class="ng-select-sm ng-select-required w-100"
                                   clearAllText="Clear"
                                   formControlName="measureUnitId" placeholder="{{'BUTTONS.CHOOSE' | translate}}"
                                   [ngClass]="{ 'is-invalid': submitted &&  productForm.get('measureUnitId').invalid }"
                        >

                          <ng-template ng-label-tmp let-item="item">

                            <span>{{item.code !== undefined ? (item.code + ' : ' + item.description) : (item.description) }}</span>

                          </ng-template>

                          <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">

                            <span>{{item.code !== undefined ? (item.code + ' : ' + item.description) : (item.description) }}</span>

                          </ng-template>

                        </ng-select>

                        <em (click)="addUM()" class="fa fa-plus"
                            ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;"
                            tooltipClass="custom-tooltip"></em>
                      </div>
                    </div>


                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.WEIGHT' | translate}} </label>
                      <input class="form-control form-control-sm" formControlName="weight" type="tel"
                             min="0"
                             [ngClass]="{ 'is-invalid': submitted &&   productForm.get('weight').invalid }"
                      >
                    </div>

                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.WEIGHT_UM' | translate}} </label>
                      <ng-select formControlName="weightUm" class="ng-select-sm"
                                 [items]="[{id: 'GR', label: ('PRODUCT_FORM.GR' | translate)},
                                 {id: 'ML', label: ('PRODUCT_FORM.ML' | translate)}]"
                                 [ngClass]="{ 'is-invalid': submitted &&  productForm.get('weightUm').invalid }"
                                 [bindLabel]="'label'" [bindValue]="'id'">
                      </ng-select>
                    </div>

                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PRICE_SALE' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="priceSale" type="tel"
                             [readOnly]="productForm.get('weighted').value">
                    </div>


                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PROMO_START_DATE' | translate}} </label>
                      <div class="input-group-icon input-group-icon-right">
                        <input
                          (click)="dateStartOffPicker.opened ? dateStartOffPicker.close() : dateStartOffPicker.open()"
                          [matDatepicker]="dateStartOffPicker" class="form-control form-control-sm"
                          formControlName="dateStartOff" placeholder="dd/mm/yyyy"
                          type="text">
                        <span
                          (click)="dateStartOffPicker.opened ? dateStartOffPicker.close() : dateStartOffPicker.open()"
                          class="input-icon input-icon-right">
                    <em class="fas fa-calendar"></em>
                  </span>
                      </div>
                      <mat-datepicker #dateStartOffPicker></mat-datepicker>
                    </div>
                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PROMO_END_DATE' | translate}} </label>
                      <div class="input-group-icon input-group-icon-right">
                        <input (click)="dateEndOffPicker.opened ? dateEndOffPicker.close() : dateEndOffPicker.open()"
                               [matDatepicker]="dateEndOffPicker" class="form-control form-control-sm"
                               formControlName="dateEndOff" placeholder="dd/mm/yyyy"
                               type="text">
                        <span (click)="dateEndOffPicker.opened ? dateEndOffPicker.close() : dateEndOffPicker.open()"
                              class="input-icon input-icon-right">
                    <em class="fas fa-calendar"></em>
                  </span>
                      </div>
                      <mat-datepicker #dateEndOffPicker></mat-datepicker>
                    </div>
                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PROMO_SCONTO_DESCRIPTION' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="desOff" type="text"
                             [ngClass]="{ 'is-invalid': submitted &&   productForm.get('desOff').invalid }">
                    </div>
                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PROMO_PRICE' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="priceOff" type="tel"
                             [ngClass]="{ 'is-invalid': submitted &&   productForm.get('priceOff').invalid }">
                    </div>
                    <div class="form-group col-lg-2 col-md-2" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PROMO_SCONTO' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="scontOff" type="tel"
                             [ngClass]="{ 'is-invalid': submitted &&   productForm.get('scontOff').invalid }">
                    </div>

                    <div class="form-group col-lg-3 col-md-3"
                         style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.MIN_STOCK' | translate}} </label>
                      <input class="form-control form-control-sm" formControlName="minStock" type="number"
                             min="0"
                             [ngClass]="{ 'is-invalid': submitted && productForm.get('minStock').invalid }"
                      >
                    </div>


                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.PURCHASE_COST' | translate}}</label>
                      <input [formControl]="purchasePriceFormControl" class="form-control form-control-sm" currencyMask
                             type="tel">
                    </div>

                    <!--
                                        <div class="form-group col-lg-3 col-md-3">
                                          <label>{{'PRODUCT_FORM.RECHARGE' | translate}} % </label>
                                          <input [formControl]="rechargeFormControl" class="form-control form-control-sm" currencyMask
                                                 type="tel">
                                        </div>

                                        <div class="form-group col-lg-3 col-md-3">
                                          <label>{{'PRODUCT_FORM.RECHARGE_SALE' | translate}} % </label>
                                          <input class="form-control form-control-sm" currencyMask formControlName="rechargeSale"
                                                 type="tel">
                                        </div>
                    -->

                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.STOCK' | translate}} </label>
                      <input class="form-control form-control-sm" formControlName="stock" type="tel" currencyMask
                             readonly>
                    </div>

                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.AVAILABILITY' | translate}} </label>
                      <input class="form-control form-control-sm" formControlName="availability" type="tel" currencyMask
                             readonly>
                    </div>

                    <div class="form-group col-lg-2 col-md-2">
                      <label>{{'PRODUCT_FORM.TYPE' | translate}} </label>
                      <ng-select formControlName="type" class="ng-select-sm"
                                 [clearable]="false"
                                 [items]="productTypeList"
                                 [ngClass]="{ 'is-invalid': submitted &&  productForm.get('type').invalid }"
                                 [bindLabel]="'label'" [bindValue]="'id'">
                      </ng-select>
                    </div>


                    <!--      <div class="form-group col-lg-3 col-md-3" *ngIf="">
                           <label>{{'PRODUCT_FORM.MAX_QUANTITY_BY_CARD' | translate}}</label>
                           <input class="form-control form-control-sm" formControlName="maxQuantityByCard"
                                  type="number">
                         </div>
                         <div class="form-group col-lg-3 col-md-3">
                           <label>{{'PRODUCT_FORM.THRESHOLD' | translate}}</label>
                           <input class="form-control form-control-sm" formControlName="threshold" type="number">
                         </div>
                         <div class="form-group col-lg-3 col-md-3">
                           <label>{{'PRODUCT_FORM.SUPPLEMENT' | translate}}</label>
                           <input class="form-control form-control-sm" currencyMask formControlName="supplement" type="tel">
                         </div>
       -->
                    <!--   <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_PRICE' | translate}}</label>
                         <input currencyMask type="tel" formControlName="packingPrice" class="form-control form-control-sm">
                       </div>
                       <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_QUANTITY' | translate}}</label>
                         <input type="number" formControlName="packingQuantity" class="form-control form-control-sm">
                       </div>
                       <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_PRICE' | translate}} 2</label>
                         <input currencyMask type="tel" formControlName="packingPrice2" class="form-control form-control-sm">
                       </div>
                       <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_QUANTITY' | translate}} 2</label>
                         <input type="number" formControlName="packingQuantity2"
                                class="form-control form-control-sm">
                       </div>
                       <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_PRICE' | translate}} 3</label>
                         <input currencyMask type="tel" formControlName="packingPrice3" class="form-control form-control-sm">
                       </div>
                       <div class="form-group col-lg-3 col-md-3">
                         <label>{{'PRODUCT_FORM.PACKING_QUANTITY' | translate}} 3</label>
                         <input type="number" formControlName="packingQuantity3"
                                class="form-control form-control-sm">
                       </div>
            -->

                  </div>
                  <!--
                  <div class="form-row">
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.WEIGHT' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="weight" type="tel">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.NET_WEIGHT' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="netWeight" type="tel">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.WEIGHT_TYPE' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="weightType" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.VAR_WEIGHT_SALE_PRICE' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="variableWeightSalePrice" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.VAR_WEIGHT_PROMO_SALE_PRICE' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="variableWeightPromoSalePrice"
                             type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.VAR_WEIGHT_PURCH_PRICE' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="variableWeightPurchasePrice"
                             type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.LxWxH' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="lxwxh" type="text">
                    </div>
                  </div>
                  -->

                  <span class="font-weight-bold">{{'PRODUCT_FORM.CATEGORY_SELECT' | translate}}</span>
                  <div class="row col-lg-3 col-md-3" style="padding-right: 0 !important">
                    <input matInput class="mt-2 w-100 form-control form-control-sm"
                           (input)="filterChanged($event.target.value)"
                           placeholder="{{'SUBHEADER.SEARCH' | translate}}">
                  </div>

                  <div class="form-group col-lg-4 col-md-4">
                  </div>
                  <div class="form-row" *ngIf="dataSource?.data">
                    <div class="form-group col-lg-12 col-md-12"
                         style="max-height:  600px!important; overflow-y: auto !important;">
                      <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
                        <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding matTreeNodeToggle>
                          <button disabled mat-icon-button></button>
                          <mat-checkbox (change)="todoLeafItemSelectionToggle(node)"
                                        [checked]="checklistSelection.isSelected(node)"
                                        [disabled]="editMode && !editClicked"
                                        class="checklist-leaf-node">{{node.item}}</mat-checkbox>
                        </mat-tree-node>

                        <mat-tree-node *matTreeNodeDef="let node; when: hasNoContent" matTreeNodePadding>
                          {{'CATEGORY_FORM.NO_CATEGORY' | translate}}
                        </mat-tree-node>

                        <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
                          <button [attr.aria-label]="'Toggle ' + node.item" mat-icon-button
                                  matTreeNodeToggle>
                            <mat-icon class="mat-icon-rtl-mirror">
                              {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                            </mat-icon>
                          </button>
                          <mat-checkbox
                            (change)="todoItemSelectionToggle(node)"
                            [checked]="descendantsAllSelected(node)"
                            [disabled]="editMode && !editClicked"
                            [indeterminate]="descendantsPartiallySelected(node)">{{node.item}}</mat-checkbox>

                        </mat-tree-node>
                      </mat-tree>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>

            <!-- additional information management tab  -->
            <ngb-tab id="tab-add-inf">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.ADDITIONAL_INF' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container" style="padding-top: 10px !important; margin-top: 0 !important;"
                     *ngIf="productForm && productForm.get('transInfo')">
                  <div class="form-row mb-2">
                    <mat-tab-group formArrayName="transInfo" [selectedIndex]="selectedTab">
                      <mat-tab *ngFor="let lang of languageList; let i = index" label="{{lang.description}}"
                               [formGroupName]="i">
                        <div class="form-group  mt-2" *ngIf="false">
                          <label>{{'PRODUCT_FORM.DESCRIPTION' | translate}}</label>
                          <input
                            [readOnly]="editMode && !editClicked"
                            [ngClass]="{ 'is-invalid': submitted && productForm.get('description').invalid }"
                            type="text" autocomplete="off" class="form-control-sm form-control ng-untouched"
                            placeholder="{{'PRODUCT_FORM.DESCRIPTION' | translate}}"
                            [formControl]="descriptionByLang"/>
                        </div>
                        <div class="form-group" *ngIf="false">
                          <label>{{'PRODUCT_FORM.COMMERCIAL_DESCRIPTION' | translate}}</label>
                          <input
                            [readOnly]="editMode && !editClicked"
                            [ngClass]="{ 'is-invalid': submitted && productForm.get('description').invalid }"
                            type="text" autocomplete="off" class="form-control-sm form-control ng-untouched"
                            placeholder="{{'PRODUCT_FORM.COMMERCIAL_DESCRIPTION' | translate}}"
                            [formControl]="commercialDescriptionByLang"/>
                        </div>

                        <div class="form-group mt-2">
                          <label>{{'PRODUCT_FORM.NOTE' | translate}}</label>
                          <ckeditor class="w-100 col-12" formControlName="note" [disabled]="editMode && !editClicked"
                                    [config]="config"></ckeditor>
                        </div>
                        <div class="form-group">
                          <label>{{'PRODUCT_FORM.ALLERGIES' | translate}}</label>
                          <ckeditor class="w-100 col-12" formControlName="allergies"
                                    [disabled]="editMode && !editClicked" [config]="config"></ckeditor>
                        </div>
                        <div class="form-group">
                          <label>{{'PRODUCT_FORM.INGREDIENTS' | translate}}</label>
                          <ckeditor class="w-100 col-12" formControlName="ingredients"
                                    [disabled]="editMode && !editClicked" [config]="config"></ckeditor>
                        </div>
                      </mat-tab>
                    </mat-tab-group>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>

            <!-- tags management tab  -->
            <ngb-tab id="tab-tags">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.TAGS' | translate}}
                & {{'PRODUCT_FORM.PACKS' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container pb-5">
                  <div class="row">
                    <div class="col-md-4 col-lg-4">
                      <h5>
                        {{'PRODUCT_FORM.TAGS' | translate}}
                      </h5>
                      <div style="display: flex">
                        <ng-select (scrollToEnd)="getConfigurationsByType('TAG')" [items]="tags" [multiple]="true"
                                   [virtualScroll]="true"
                                   bindLabel="description" bindValue="id"
                                   class=" ng-select-required " formControlName="tagIds" style="width: 100%">
                          <ng-template ng-label-tmp let-item="item">
                            <span class="p-1">{{setTagDescription(item)}}</span>
                          </ng-template>
                          <ng-template let-index="index" let-item="item" let-item$="item$" ng-option-tmp>
                            <input [(ngModel)]="item$.selected" [ngModelOptions]="{ standalone : true }"
                                   id="item-{{index}}"
                                   type="checkbox"/>
                            {{setTagDescription(item)}}
                          </ng-template>
                        </ng-select>
                        <em (click)="addTag()" class="fa fa-plus" ngbTooltip="{{'BUTTONS.ADD'|translate}}"
                            placement="left"
                            style="margin: 7px;" tooltipClass="custom-tooltip"></em>
                      </div>
                    </div>
                    <div class="col-md-4 col-lg-4">
                      <h5>
                        {{'PRODUCT_FORM.PACKS' | translate}}
                      </h5>
                      <div class="d-flex justify-content-between mb-3" style="margin-right: 14px !important;">
                        <div></div>
                        <a (click)="addPack(packContent)" *ngIf="!editMode || editClicked "
                           class="text-muted "><em class="fa fa-plus"></em></a>
                      </div>
                      <div>
                    <span *ngFor="let pack of packs; index as i" class="badge badge-accent">
                       <span class="badge-text">{{pack.price | number: '.2-2'}} per {{pack.quantity}}</span>
                    <button (click)="cancelPack(i)" aria-label="Dismiss" class="close" type="button">
                     <span aria-hidden="true">&times;</span>
                    </button>
                  </span>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>

            <!--   seo management tab  -->
            <ngb-tab id="tab-seo">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.SEO' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container">
                  <div class="form-row">
                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.URL_KEY' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="urlKey" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.META_TITLE' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="metaTitle" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.META_KEY' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="metaKey" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3" style="padding-right: 10px !important">
                      <label>{{'PRODUCT_FORM.META_DESCRIPTION' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="metaDescription" type="text">
                    </div>

                  </div>
                </div>
              </ng-template>
            </ngb-tab>

            <!--   characteristic management tab  -->
            <!--
            <ngb-tab id="tab-selectbyid5">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.ALCOHOLIC_PRODUCTS' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container">
                  <div class="form-row">
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.FOOD_PAIRING' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="foodPairing" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.ALCOHOL_PERC' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="alcoholPercentage"
                             type="tel">
                    </div>

                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.VINE_DESIGNATION' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="grapeVineDesignation" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.SERV_TEMP' | translate}}</label>
                      <input class="form-control form-control-sm" currencyMask formControlName="servingTemperature"
                             type="tel">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.TYPOLOGIA' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="typologia" type="text">
                    </div>
                    <div class="form-group col-lg-3 col-md-3">
                      <label>{{'PRODUCT_FORM.REGION' | translate}}</label>
                      <input class="form-control form-control-sm" formControlName="region" type="text">
                    </div>
                    <div class="form-group col-lg-12 col-md-12">
                      <label>{{'PRODUCT_FORM.PRODUCT_HISTORY' | translate}}</label>
                      <textarea class="form-control" formControlName="productHistory" rows="3"
                                style="resize: none"></textarea>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>
            -->

            <!--   images management tab  -->
            <ngb-tab id="tab-images" [disabled]="!editMode">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.IMAGE' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container tab-container">
                  <div class="row">
                    <div class="form-group col-12">
                      <div class="font-14 font-weight-bold">
                        {{'PRODUCT_FORM.IMAGE' | translate}}
                        <button mat-icon-button (click)="openImageCropper()" class="pull-right">
                          <mat-icon>add</mat-icon>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="row sortable-grid">
                    <div class="col-xl-3 col-lg-3 col-md-6 col-12 sortable-item"
                         *ngFor="let img of localResources; let i = index">
                      <div class="thumbnail mt-3">
                        <img [src]="img.url?.replace('_me','_la')" [alt]="img.name">
                        <ul class="menu-overlay">
                          <li>
                            <button matTooltip="{{'BUTTONS.MAIN_IMAGE' | translate}}"
                                    (click)="$event.stopPropagation(); setMainImage(img.url)"
                                    matTooltipPosition="above"
                                    mat-icon-button color="primary">
                              <em class="fas fa-star"></em>
                            </button>
                          </li>
                          <li>
                            <button matTooltip="{{'BUTTONS.DELETE' | translate}}"
                                    matTooltipPosition="above"
                                    (click)="$event.stopPropagation(); deleteImage(img.name)"
                                    mat-icon-button color="primary">
                              <em class="fas fa-trash"></em>
                            </button>
                          </li>
                        </ul>
                      </div>
                      <div class="col-12 text-center">
                        <label style="text-align: center;margin-top: 10px">
                          <strong>{{img.colorCode}} {{img.colorDesc}}</strong>
                        </label>
                      </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-6 col-12 sortable-item"
                         *ngFor="let img of sellPointResources; let i = index">
                      <div class="thumbnail mt-3">
                        <img [src]="img.url?.replace('_me','_la')"
                             [alt]="img.name?.replace('_me','_la')">
                        <ul class="menu-overlay">
                          <li>
                            <button matTooltip="{{'BUTTONS.MAIN_IMAGE' | translate}}"
                                    (click)="$event.stopPropagation(); setMainImage(img.url)"
                                    matTooltipPosition="above"
                                    mat-icon-button color="primary">
                              <em class="fas fa-star"></em>
                            </button>
                          </li>
                        </ul>
                      </div>
                      <div class="col-12 text-center">
                        <label style="text-align: center;margin-top: 10px">
                          <strong>{{img.colorCode}} {{img.colorDesc}}</strong>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

              </ng-template>
            </ngb-tab>

            <!--   history tab  -->
            <ngb-tab id="tab-history" [disabled]="!editMode">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.HISTORY' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container">
                  <div class="row d-flex justify-content-center">
                    <div class="col-lg-5">
                      <div class="card">
                        <div class="card-body text-center card-mob">
                          <h4>{{'DATA_TABLE.QUANTITY' | translate}} {{product.stock | number: '1.3-3'}}</h4>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-5">
                      <div class="card">
                        <div class="card-body text-center card-mob">
                          <h4>{{'PRODUCT_FORM.AVAILABILITY' | translate}} {{product.availability | number: '1.3-3'}}</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                  <table class="table table-sm ">
                    <caption></caption>
                    <thead>
                    <tr>
                      <th *ngFor="let c of stockColumns" scope="col"
                          style="padding: 1rem 0.7rem !important;">{{c | translate}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let c of stockHistoryRows">
                      <td> {{c.createdAt | date: 'dd/MM/yyyy HH:mm:ss'}}</td>
                      <td>{{c.quantity| number: '1.3-3'}}</td>
                      <td>{{c.stockType}}</td>
                      <td>{{c.price != null ? ((c.price   | number: '1.2-2') + ' €') : ''}}</td>
                      <td *ngIf="c.causal == 'RETURN'">{{(c.price  | number: '1.2-2') + ' €'}}</td>
                      <td *ngIf="c.causal != 'RETURN'">{{(c.quantity * c.price  | number: '1.2-2') + ' €'}}</td>
                      <td>{{'MOVEMENT_FORM.' + c.causal | translate}}</td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </ng-template>
            </ngb-tab>

            <!--   color/size management tab  -->
            <ngb-tab id="tab-tail-color" [disabled]="!showSizeColor">
              <ng-template ngbTabTitle>{{'PRODUCT_FORM.SIZE_AND_COLOR' | translate}}</ng-template>
              <ng-template ngbTabContent>
                <div class="container">
                  <div class="form-row">
                    <div class="card-body table-responsive">
                      <table class="table  table-sm  table-hover table-bordered" aria-describedby="">
                        <thead>
                        <tr>
                          <th scope="col"> {{'PRODUCT_FORM.SIZE_COLOR' | translate}} : {{product?.sizeName}}</th>
                          <th *ngFor="let c of  sizes" scope="col"
                              style="text-align: center">{{c.name  | translate}}</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let val of colors; let i = index">
                          <td>{{(val.code ? val.code : '') + ' ' + val.name}}</td>
                          <td *ngFor="let s of val.sizes; let j = index">
                            <div class="d-flex justify-content-around">
                              <span>{{s.stock}} </span> <span>|</span> <span>{{ s.price | number: '.2-2'}} </span>
                            </div>
                          </td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </ng-template>

            </ngb-tab>


          </ngb-tabset>

          <button style="position:absolute; right:0; top:20px;" (click)="activateEdit()"
                  *ngIf="editMode && !editClicked" color="primary" mat-button>
            <mat-icon>edit</mat-icon>
            {{'BUTTONS.EDIT' | translate}}
          </button>

          <button style="position:absolute; right:0; top:20px;" (click)="save()" *ngIf="!editMode || editClicked "
                  [disabled]="disableSave" color="primary"
                  form="productForm"
                  mat-button ngbTooltip="{{'BUTTONS.SAVE'|translate}}" placement="left"
                  tooltipClass="custom-tooltip">
            <mat-icon>save</mat-icon>
            {{'BUTTONS.SAVE' | translate}}
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<!--<ng-template #stockHistoryTemplate>-->
<!--  <app-stock-history [data]="productDetails">-->
<!--  </app-stock-history>-->
<!--  <div mat-dialog-actions>-->
<!--    <button (click)="dRef.close()" color="secondary" mat-button><em class="ft-x"></em>-->
<!--      {{'BUTTONS.CLOSE' | translate}}</button>-->
<!--  </div>-->
<!--</ng-template>-->

<ng-template #printTicket>
  <h1 mat-dialog-title>
    {{(printMode !== 1 ? 'PRODUCT_FORM.PRINT_TICKET' : 'PRODUCT_FORM.PRINT_FACE_PLATES') | translate}}
  </h1>
  <hr>
  <div mat-dialog-content>
    <div class="form-group col-lg-12 col-sm-12">
      <label>{{'PRODUCT_FORM.PRINT_QUANTITY' | translate}}:</label>
      <div class="input-group-icon input-group-icon-left">
        <span class="input-icon input-icon-left">
          <em class="ti-info"></em>
        </span>
        <input #descInput [(ngModel)]="ticketNumber" class="form-control" min="1" type="number">
      </div>
    </div>
    <div class="form-group col-lg-12 col-sm-12">
      <label>{{'PRODUCT_FORM.ETIQUETTE_TYPE' | translate}}:</label>
      <div class="input-group-icon input-group-icon-right">
        <ng-select (open)="translateTypes()" [(ngModel)]="selectedType" [bindLabel]="'description'"
                   [bindValue]="'id'" [items]="types" [virtualScroll]="true" appendTo="body"
                   class="ng-select-barcode-type ng-select"
                   placeholder="{{'PRODUCT_FORM.ETIQUETTE_TYPE' | translate}}">
        </ng-select>
      </div>
    </div>
  </div>
  <hr>
  <div class="d-flex justify-content-end" mat-dialog-actions>
    <button (click)="dialogRef.close(null)" class="ml-2" color="secondary" mat-button>{{'BUTTONS.CLOSE' |
        translate}}</button>
    <button (click)="dialogRef.close(ticketNumber)" [disabled]="ticketNumber==null||ticketNumber<=0" color="primary"
            mat-flat-button>{{'BUTTONS.PRINT' | translate}}
    </button>
  </div>
</ng-template>

<ng-template #content>
  <div class="modal-header">
    <h4 mat-dialog-title>{{'PRODUCT_UM_FORM.CONFIG_UM' | translate}}</h4>
    <button mat-button mat-dialog-close type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="productUmForm" id="productUmForm">
      <div class="row">

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_UM_FORM.UM' | translate}} :</label>
          <ng-select (clear)="clear()" (close)="reset()" (open)="open()"
                     (scrollToEnd)="getLazyUm({ page: this.umPage, pageSize: 10})"
                     (search)="searchUm($event)" [items]="um" [loading]="loading"
                     [virtualScroll]="true"
                     bindLabel="code" bindValue="id" class="ng-select-sm ng-select-required" clearAllText="Clear"
                     [ngClass]="{ 'is-invalid': submitted && productUmForm.get('umId').invalid }"

                     formControlName="umId" placeholder="{{'BUTTONS.CHOOSE' | translate}}">
          </ng-select>
        </div>

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_UM_FORM.MULTIPLY' | translate}} :</label>
          <input class="form-control form-control-sm" formControlName="multiply"
                 [ngClass]="{ 'is-invalid': submitted && productUmForm.get('multiply').invalid }"

                 placeholder="{{'PRODUCT_UM_FORM.MULTIPLY' | translate}}" type="number">
        </div>

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_UM_FORM.DESCRIPTION' | translate}} :</label>
          <input class="form-control form-control-sm" formControlName="description"
                 placeholder="{{'PRODUCT_UM_FORM.DESCRIPTION' | translate}}" type="text">
        </div>
      </div>
      <div class="modal-footer">
        <div mat-dialog-actions>
          <button (click)="dialogRef.close(null)" class="mr-3" color="primary" mat-flat-button>{{'BUTTONS.CLOSE' |
              translate}}
          </button>

          <button (click)="saveUm()" color="primary" mat-flat-button>{{'BUTTONS.SAVE' | translate}}
          </button>
        </div>
      </div>

    </form>
  </div>
</ng-template>

<ng-template #productCode>
  <div class="modal-header">
    <h4 mat-dialog-title>{{'PRODUCT_FORM.PRODUCT_CODE_CONFIGURATION' | translate}}</h4>
    <button mat-button mat-dialog-close type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="productCodeForm" id="productCodeForm">
      <div class="row" style="margin-bottom: 106px;">


        <div class="form-check col-lg-12 col-md-12 mb-3 mt-1">
          <input class="form-check-input" formControlName="defaultCode" id="exampleCheck1" type="checkbox">
          <label class="form-check-label" for="exampleCheck1">{{'PRODUCT_FORM.DEFAULT_CODE' | translate}}</label>
        </div>

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.CODE' | translate}} :</label>
          <input class="form-control form-control-sm" formControlName="code"
                 placeholder="{{'PRODUCT_FORM.CODE' | translate}}"
                 type="text">
          <div *ngIf="!validBarcode && productCodeForm.get('code').value?.length > 0  && (!editMode || editClicked)"
               class="invalid-feedback">
            <em class="fas fa-times"></em> {{'PRODUCT_FORM.INVALID_BARCODE' | translate}}<br/>
          </div>
          <div
            *ngIf="!uniqueBarcode && productCodeForm.get('code').value?.length > 0  && validBarcode && (!editMode || editClicked)"
            class="invalid-feedback">
            <em class="fas fa-times"></em> {{'PRODUCT_FORM.NON_UNIQUE_BARCODE' | translate}}<br/>
          </div>
        </div>


        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.CODE_TYPE' | translate}} :</label>
          <ng-select (open)="translateProductCodeTypes()" [bindLabel]="'description'" [bindValue]="'id'"
                     [clearable]="false" [items]="productCodeTypes" [virtualScroll]="true" class="ng-select-sm"
                     formControlName="codeType">
          </ng-select>
        </div>


        <div *ngIf="productCodeForm.get('codeType').value == 'CUSTOMER'" class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.CUSTOMER_CODE' | translate}} :</label>
          <input class="form-control form-control-sm" formControlName="customerCode"
                 placeholder="{{'PRODUCT_FORM.CUSTOMER_CODE' | translate}}" type="text">
        </div>

        <div *ngIf="productCodeForm.get('codeType').value == 'SUPPLIER'" class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.SUPPLIER_CODE' | translate}} :</label>
          <input class="form-control form-control-sm" formControlName="supplierCode"
                 placeholder="{{'PRODUCT_FORM.SUPPLIER_CODE' | translate}}" type="text">
        </div>

      </div>
      <div class="modal-footer">
        <div mat-dialog-actions>
          <button (click)="dialogRef.close(null)" class="mr-3" color="primary" mat-flat-button>{{'BUTTONS.CLOSE' |
              translate}}
          </button>
          <button (click)="saveProductCode()" color="primary" mat-flat-button>{{'BUTTONS.SAVE' | translate}}
          </button>
        </div>
      </div>

    </form>
  </div>
</ng-template>

<ng-template #listini>
  <div class="modal-header">
    <h4 mat-dialog-title>{{'PRODUCT_FORM.PRICE_LIST' | translate}}</h4>
    <button mat-button mat-dialog-close type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">

    <div *ngIf="listPrice.length == 0" class="subheader">
      <div class="action-btns mb-2" style="text-align: right;">
        <button (click)="add()" color="primary" mat-mini-fab ngbTooltip="{{'PRODUCT_FORM.ADD_PRICE'|translate}}"
                placement="left"
                tooltipClass="custom-tooltip">
          <em class="ft-plus" style="font-size: 20px;"></em>
        </button>
      </div>
    </div>

    <div class="card card-fullheight">
      <div class="card-body table-responsive">
        <table class="table  table-sm  table-hover  table-bordered">
          <caption></caption>
          <!--sonar-->
          <thead>
          <tr>
            <th *ngFor="let c of columns" scope="col">{{c | translate}}</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let r of listPrice">
            <td>{{getDefaultProductCode(r.product).code}}</td>
            <td>{{r.product.description}}</td>
            <td>{{r.priceList1Value | number: '.2-2'}}</td>
            <td>{{r.priceList1FormulaField}}</td>
            <td>{{r.priceList2Value | number: '.2-2'}}</td>
            <td>{{r.priceList2FormulaField}}</td>
            <td>{{r.priceList3Value | number: '.2-2'}}</td>
            <td>{{r.priceList3FormulaField}}</td>
            <td>{{r.priceList4Value | number: '.2-2'}}</td>
            <td>{{r.priceList4FormulaField}}</td>
            <td>
              <button (click)="editListini($event, r)" color="warn" mat-icon-button
                      ngbTooltip="{{'PRODUCT_FORM.EDIT'|translate}}"
                      placement="top" tooltipClass="custom-tooltip">
                <em class="ft-edit"></em>
              </button>
            </td>
            <td>
              <button (click)="deleteListini($event, r)" color="warn" mat-icon-button
                      ngbTooltip="{{'PRODUCT_FORM.CANCEL'|translate}}"
                      placement="top" tooltipClass="custom-tooltip">
                <em class="ft-trash-2"></em>
              </button>
            </td>
          </tr>
          </tbody>
        </table>

      </div>
    </div>
  </div>
</ng-template>

<ng-template #packContent>
  <div class="modal-header">
    <h4 mat-dialog-title>{{'PRODUCT_FORM.ADD_PACK' | translate}}</h4>
    <button mat-button mat-dialog-close type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="packForm" id="packForm">
      <div class="row">

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.PRICE' | translate}} :</label>
          <input class="form-control form-control-sm" currencyMask
                 formControlName="price" type="tel"
          >
        </div>

        <div class="form-group col-lg-6 col-md-6">
          <label>{{'PRODUCT_FORM.QUANTITY' | translate}} :</label>
          <input class="form-control form-control-sm"
                 formControlName="quantity" type="number">
        </div>
      </div>
      <div class="modal-footer">
        <div mat-dialog-actions>
          <button (click)="dialogRefPack.close(false)" class="mr-3" color="primary" mat-flat-button>{{'BUTTONS.CLOSE' |
              translate}}
          </button>

          <button (click)="dialogRefPack.close(true)" color="primary" mat-flat-button>{{'BUTTONS.SAVE' | translate}}
          </button>
        </div>
      </div>

    </form>
  </div>
</ng-template>

<ng-template #showProductCode>
  <div class="modal-header">
    <h4 mat-dialog-title>{{'PRODUCT_FORM.CODE' | translate}}</h4>
    <button type="button" mat-button mat-dialog-close>
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="flexbox mb-3" *ngFor="let pct of altProdCodes">
      <div><span> {{pct.code }}</span>
      </div>
      <span class="mb-0 text-muted small-text">{{pct.codeType}}</span>
    </div>
  </div>
</ng-template>


